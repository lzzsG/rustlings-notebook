# macros

---

åœ¨è¿™ä¸ªç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç» Rust ä¸­çš„å®ï¼ˆmacrosï¼‰ï¼Œä¸€ç§å¼ºå¤§çš„å·¥å…·ï¼Œå®ƒè®©ä½ èƒ½å¤Ÿç¼–å†™å‡ºæ›´çµæ´»å’Œå¯é‡ç”¨çš„ä»£ç ã€‚å®é€šè¿‡åœ¨ç¼–è¯‘æ—¶å±•å¼€ä»£ç æ¥å·¥ä½œï¼Œä»è€Œå®ç°ç¼–å†™ DRYï¼ˆä¸é‡å¤è‡ªå·±ï¼‰çš„ä»£ç å’Œè¿›è¡Œå…ƒç¼–ç¨‹ã€‚

### åŸºæœ¬ä»‹ç»

å®åœ¨ Rust ä¸­ä¸»è¦æœ‰ä¸¤ç§ç±»å‹ï¼šå£°æ˜å®ï¼ˆDeclarative Macrosï¼‰å’Œè¿‡ç¨‹å®ï¼ˆProcedural Macrosï¼‰ã€‚

- **å£°æ˜å®**ï¼šå…è®¸ä½ ç¼–å†™å¯ç”¨äºç”Ÿæˆé‡å¤ä»£ç çš„æ¨¡å¼ï¼ˆpatternsï¼‰ã€‚
- **è¿‡ç¨‹å®**ï¼šæ›´åƒæ˜¯å°å‹çš„ç¼–è¯‘å™¨æ’ä»¶ï¼Œå®ƒä»¬æ“ä½œ Rust ä»£ç çš„è¯­æ³•æ ‘ã€‚

### å®çš„å­¦ä¹ è¦ç‚¹

1. **åŸºæœ¬ç»“æ„**ï¼šç†è§£å®å®šä¹‰çš„åŸºæœ¬è¯­æ³•å’Œç»“æ„ã€‚
2. **åŒ¹é…å’Œæ‰©å±•**ï¼šå­¦ä¹ å¦‚ä½•åœ¨å®ä¸­åŒ¹é…ä¸åŒçš„è¾“å…¥æ¨¡å¼ï¼Œå¹¶ç”Ÿæˆç›¸åº”çš„ä»£ç ã€‚
3. **å®çš„ä½¿ç”¨åœºæ™¯**ï¼šç†è§£å®åœ¨å®é™…å¼€å‘ä¸­çš„åº”ç”¨ï¼Œå¦‚ä»£ç ç”Ÿæˆã€ä»£ç å¤ç”¨å’Œæ€§èƒ½ä¼˜åŒ–ã€‚

### ç»ƒä¹ ä»‹ç»

**Exercise 84: macros1**

- è¿™ä¸ªç»ƒä¹ å¼•å¯¼ä½ å­¦ä¹ å¦‚ä½•å®šä¹‰å’Œä½¿ç”¨æœ€åŸºæœ¬çš„å£°æ˜å®ã€‚
- ä½ å°†å­¦ä¹ å¦‚ä½•è°ƒç”¨å®ä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•ä»ç®€å•çš„å®è°ƒç”¨ä¸­æ‰©å±•æˆå®Œæ•´çš„ä»£ç ç‰‡æ®µçš„ã€‚

**Exercise 85: macros2**
- æœ¬ç»ƒä¹ æ—¨åœ¨è§£å†³å®çš„ä½œç”¨åŸŸå’Œå¯è§æ€§é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šä¸ªæ¨¡å—å’Œæ–‡ä»¶ä¸­ä½¿ç”¨å®æ—¶ã€‚
- ä½ å°†å­¦ä¹ åˆ°å®å®šä¹‰å’Œä½¿ç”¨çš„ä½ç½®å¯¹å…¶å¯è§æ€§çš„å½±å“ã€‚

**Exercise 86: macros3**
- è¿™ä¸ªç»ƒä¹ å°†ä»‹ç»å¦‚ä½•å°†å®ä»ä¸€ä¸ªæ¨¡å—å¯¼å‡ºåˆ°å¦ä¸€ä¸ªæ¨¡å—ï¼Œè¿™æ˜¯ç†è§£å’Œä½¿ç”¨ Rust å®ç³»ç»Ÿçš„é‡è¦éƒ¨åˆ†ã€‚
- é€šè¿‡è¿™ä¸ªç»ƒä¹ ï¼Œä½ å°†å­¦ä¹ å¦‚ä½•ä½¿å®åœ¨ä¸åŒçš„æ¨¡å—æˆ–åº“ä¸­å¯ç”¨ã€‚

**Exercise 87: macros4**
- è¿™ä¸ªç»ƒä¹ æ¶‰åŠåˆ°å®šä¹‰åŒ…å«å¤šä¸ªåˆ†æ”¯çš„å®ï¼Œå¸®åŠ©ä½ æ·±å…¥ç†è§£ Rust å®çš„åˆ†æ”¯æœºåˆ¶ã€‚
- ä½ å°†é€šè¿‡æ·»åŠ ç‰¹å®šçš„è¯­æ³•å…ƒç´ æ¥åŒºåˆ†å®ä¸­çš„ä¸åŒåˆ†æ”¯ï¼Œè¿™å¯¹äºç¼–å†™å¤æ‚çš„å®è‡³å…³é‡è¦ã€‚

> åœ¨`macros1`åæ‰©å±•äº†æ›´å¤šå†…å®¹

### é«˜çº§å®æŠ€å·§

éšç€ä½ å¯¹å®çš„è¿›ä¸€æ­¥å­¦ä¹ ï¼Œä½ å°†èƒ½å¤Ÿæ¢ç´¢æ›´å¤æ‚çš„å®ä½¿ç”¨æ–¹å¼ï¼Œä¾‹å¦‚ï¼š
- **é«˜çº§æ¨¡å¼åŒ¹é…**ï¼šä½¿ç”¨é«˜çº§æ¨¡å¼åŒ¹é…æ¥æ•è·å’Œæ“ä½œæ›´å¤æ‚çš„è¾“å…¥ã€‚
- **ç”Ÿæˆ API**ï¼šä½¿ç”¨å®æ¥è‡ªåŠ¨ç”Ÿæˆä»£ç ï¼Œç®€åŒ– API çš„å®ç°å’Œä½¿ç”¨ã€‚
- **é”™è¯¯å¤„ç†**ï¼šåœ¨å®ä¸­å®ç°é”™è¯¯æ£€æµ‹å’Œå¤„ç†ï¼Œç¡®ä¿ç”Ÿæˆçš„ä»£ç çš„å¥å£®æ€§å’Œå®‰å…¨æ€§ã€‚

é€šè¿‡è¿™äº›ç»ƒä¹ å’Œæ¦‚å¿µï¼Œä½ å°†èƒ½å¤Ÿæ›´æœ‰æ•ˆåœ°åˆ©ç”¨ Rust çš„å®æ¥ç¼–å†™é«˜æ•ˆã€å¯ç»´æŠ¤å’Œå¼ºå¤§çš„ Rust ä»£ç ã€‚s

---

```rust
// ä½ ä¸å¿…ç°åœ¨ç†è§£ä»¥ä¸‹ä»£ç ï¼Œå®ƒä¹Ÿè¿è¡Œä¸èµ·æ¥ã€‚

macro_rules! cast_spell {
    ($spell:expr) => {
        println!("Casting spell: {}", $spell);
    };
}

mod spells {
    #[macro_export]
    macro_rules! conjure {
        () => {
            println!("Conjuring something mystical!");
        };
    }
}

mod enchanted_forest {
    pub use crate::spells::conjure;
}

macro_rules! perform_magic {
    (fire) => {
        println!("A fireball explodes into the sky.");
    };
    (water) => {
        println!("A wave of water sweeps across the ground.");
    };
    (earth) => {
        println!("The earth trembles beneath your feet.");
    };
}

fn main() {
    cast_spell!("Lumos");

    enchanted_forest::conjure!();

    perform_magic!(fire);
    perform_magic!(water);
    perform_magic!(earth);

    println!("\nYour journey continues into the dark forest.ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²");
}
```
